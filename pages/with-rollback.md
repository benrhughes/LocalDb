<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /pages/mdsource/with-rollback.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# With Rollback

Multiple actions a targeted to the same database and changes are rolled back instead of being committed.

Characteristics:

 * Better performance that the standard API.
 * If a test fails, it is not possible to look at the current database state.

If a test has failed, to debug the database state, temporarily switch back to the standard API.


## Usage

<!-- snippet: WithRollback -->
<a id='snippet-withrollback'/></a>
```cs
var sqlInstance = new SqlInstance(
    name: "theInstanceName",
    buildTemplate: TestDbBuilder.CreateTable
);

await using var sqlDatabase = await sqlInstance.BuildWithRollback();
var sqlConnection = sqlDatabase.Connection;
//Use the SqlConnection
```
<sup>[snippet source](/src/LocalDb.Tests/Snippets/WithRollback.cs#L8-L17) / [anchor](#snippet-withrollback)</sup>
<!-- endsnippet -->


## EntityFramework Usage

<!-- snippet: EfWithRollback -->
<a id='snippet-efwithrollback'/></a>
```cs
var sqlInstance = new SqlInstance<TheDbContext>(
    constructInstance: builder => new TheDbContext(builder.Options));

using var sqlDatabase = await sqlInstance.BuildWithRollback();
var sqlConnection = sqlDatabase.Connection;
var dbContext = sqlDatabase.Context;
//Use the SqlConnection or TheDbContext
```
<sup>[snippet source](/src/EfLocalDb.Tests/Snippets/WithRollback.cs#L8-L16) / [anchor](#snippet-efwithrollback)</sup>
<!-- endsnippet -->
